<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
    
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Mybus : Pebble watchface and watchapp for displaying translink data" />
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
<!--     <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
 -->
    <title>Interbble Timer</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <h4 id="project_title">Interbble Timer Configuration</h4>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <form id="config-form" class="inner" action="#" method="POST">
        <div data-role="content" style="padding:0px 20px 0px 20px;">
          <label for="select-program">Program:</label>
          <select id="select-program" data-native-menu="false">
            <option value="walk10k">Learn to Walk 10K</option>
            <option value="run10k" selected>Learn to Run 10K</option>
            <option value="runWalk10k">Run/Walk 10K</option>
            <option value="run10kFaster">Run 10K Faster</option>
          </select>
        </div>
        <div data-role="content" style="padding:0px 20px 0px 20px;">
          <label for="select-week">Week:</label>
          <select id="select-week" data-native-menu="false">
            <option value="week1">Week 1</option>
            <option value="week2">Week 2</option>
            <option value="week3">Week 3</option>
            <option value="week4">Week 4</option>
            <option value="week5">Week 5</option>
            <option value="week6">Week 6</option>
            <option value="week7">Week 7</option>
            <option value="week8">Week 8</option>
            <option value="week9">Week 9</option>
            <option value="week10">Week 10</option>
            <option value="week11">Week 11</option>
            <option value="week12">Week 12</option>
            <option value="week13">Week 13</option>
          </select>
        </div>
        <div data-role="content" style="padding:0px 20px 0px 20px;">
          <label for="select-session">Session:</label>
          <select id="select-session" data-native-menu="false">
            <option value="session1">Session 1</option>
            <option value="session2">Session 2</option>
            <option value="session3">Session 3</option>
          </select>
        </div>
        <div class="form-group" style="padding:0px 20px 0px 20px;">
          <button type="submit" data-theme="a" id="b-submit">Save Changes</button>
        </div>
      </form>
      <!-- <form id="config-form" class="inner" action="#" method="POST">
         <div class="form-group" style="padding-right:20px">
          <label for="stopNum" style="font-size:20; font-weight:bold; padding-right:30px">Stop Number:</label>
          <input type="text" id="stopNum" name="stopNum" class="form-control" placeholder="51082" style="height:25px"/>
        </div>
        <div class="form-group" style="padding-top:20px; padding-right:20px">
          <label for="routeNum" style="font-size:20; font-weight:bold; padding-right:30px">Route Number:</label>
          <input type="text" id="routeNum" name="routeNum" class="form-control" placeholder="003" style="height:25px"/>
        </div>
        <div class="form-group" style="padding-right:20px">
          <button type="submit" data-theme="a" id="b-submit">Save Changes</button>
        </div>
      </form> -->
    </div>

    <script type="text/javascript">
      $().ready(function () {

        var selectedProgram = localStorage.getItem("selected_program");
        var selectedWeek = localStorage.getItem("selected_week");
        var selectedSession = localStorage.getItem("selected_session");

        console.log("Loading saved settings -- program: " + selectedProgram + ", week: " + selectedWeek + ", session: " + selectedSession);

        $("#select-program").val(selectedProgram);
        $("#select-week").val(selectedWeek);
        $("select-session").val(selectedSession);

        $("#config-form").submit(function(e) {
          var program = $("#select-program").val();
          var week = $("#select-week").val();
          var session = $("#select-session").val();

          //load the json object
          $.getJSON("programs.json", function(json) {

            //pull out the appropriate interval segment for the selected program
            var configObj = json[program][week][session];
            configObj.program_title = $("#select-program option:selected").text();
            configObj.session_title = $("#select-week option:selected").text() + " " + $("#select-session option:selected").text();
            console.log(configObj);
            console.log(JSON.stringify(configObj));

            //save in local storage
            localStorage.setItem("selected_program", program);
            localStorage.setItem("selected_week", week);
            localStorage.setItem("selected_session", session);

            console.log("Configuration form submitted  -- program: " + program + ", week: " + week + ", session: " + session);

            document.location = "pebblejs://close#" + JSON.stringify(configObj);
          });

          e.preventDefault();

        });
      }); 
      </script>

  </body>
</html>
